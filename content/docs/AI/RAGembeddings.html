<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RAG Embeddings | Ethan</title>
    <meta name="description" content="Ethan's Note.">
    <link rel="preload stylesheet" href="/MyBlog/assets/style.3654e1ee.css" as="style">
    <script type="module" src="/MyBlog/assets/app.e1a1d36e.js"></script>
    <link rel="preload" href="/MyBlog/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/MyBlog/assets/chunks/framework.7cada2c9.js">
  <link rel="modulepreload" href="/MyBlog/assets/chunks/theme.f8eae494.js">
  <link rel="modulepreload" href="/MyBlog/assets/content_docs_AI_RAGembeddings.md.d4ed9e1b.lean.js">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout"><header class="Nav" data-v-e0b30f32><div class="fixed header-bar" data-v-e0b30f32></div><div class="VPNavBar" data-v-e0b30f32 data-v-41b28390><div class="container" data-v-41b28390><div class="title" data-v-41b28390><div class="VPNavBarTitle" data-v-41b28390 data-v-f8891078><a class="title" href="/MyBlog/" data-v-f8891078><!--[--><!--]--><!----><!--[-->Ethan<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-41b28390><div class="curtain" data-v-41b28390></div><div class="content-body" data-v-41b28390><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-41b28390><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><img class="nav-icon" src="https://raw.githubusercontent.com/fzdwx/blog-history/main/static/images/party_parrot.gif" data-v-41b28390><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-41b28390 data-v-4ea07044><span id="main-nav-aria-label" class="visually-hidden" data-v-4ea07044>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/MyBlog/" tabindex="0" data-v-4ea07044 data-v-adc2a979 data-v-151d3d72><!--[-->Home<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/MyBlog/tags.html?layout=issue" tabindex="0" data-v-4ea07044 data-v-adc2a979 data-v-151d3d72><!--[-->Notes<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/MyBlog/tags.html?layout=doc" tabindex="0" data-v-4ea07044 data-v-adc2a979 data-v-151d3d72><!--[-->Docs<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/MyBlog/tags.html?layout=post" tabindex="0" data-v-4ea07044 data-v-adc2a979 data-v-151d3d72><!--[-->Tags<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-41b28390 data-v-3c32f197><label title="toggle dark mode" data-v-3c32f197 data-v-8ab045d8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-8ab045d8 data-v-c362e90c><span class="check" data-v-c362e90c><span class="icon" data-v-c362e90c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-8ab045d8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-8ab045d8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-41b28390 data-v-426ff4ea data-v-eee56282><!--[--><a class="VPSocialLink" href="https://github.com/fzdwx/vitepress-blog-theme" aria-label="github" target="_blank" rel="noopener" data-v-eee56282 data-v-0b9e0215><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-41b28390 data-v-458f3edb data-v-4df5a56a><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-4df5a56a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-4df5a56a><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-4df5a56a><div class="VPMenu" data-v-4df5a56a data-v-2ad5faca><!----><!--[--><!--[--><!----><div class="group" data-v-458f3edb><div class="item appearance" data-v-458f3edb><p class="label" data-v-458f3edb>Appearance</p><div class="appearance-action" data-v-458f3edb><label title="toggle dark mode" data-v-458f3edb data-v-8ab045d8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-8ab045d8 data-v-c362e90c><span class="check" data-v-c362e90c><span class="icon" data-v-c362e90c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-8ab045d8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-8ab045d8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div></div></div><div class="group" data-v-458f3edb><div class="item social-links" data-v-458f3edb><div class="VPSocialLinks social-links-list" data-v-458f3edb data-v-eee56282><!--[--><a class="VPSocialLink" href="https://github.com/fzdwx/vitepress-blog-theme" aria-label="github" target="_blank" rel="noopener" data-v-eee56282 data-v-0b9e0215><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger active hamburger" aria-label="mobile navigation" aria-expanded="true" aria-controls="VPNavScreen" data-v-41b28390 data-v-2575c4db><span class="container" data-v-2575c4db><span class="top" data-v-2575c4db></span><span class="middle" data-v-2575c4db></span><span class="bottom" data-v-2575c4db></span></span></button></div></div></div></div></header><div class="ContentDispatch" data-v-b07fbd0c><div class="center" data-v-b07fbd0c><aside class="VPSidebar" data-v-fd68176f><div class="curtain" data-v-fd68176f></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-fd68176f><span class="visually-hidden" id="sidebar-aria-label" data-v-fd68176f> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-fd68176f><section class="VPSidebarItem level-0" data-v-fd68176f data-v-fd6a75f8><div class="item" role="button" tabindex="0" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><h2 class="text" data-v-fd6a75f8>æ•°å­¦</h2><!----></div><div class="items" data-v-fd6a75f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Math/CartesianCoordinateSystem.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>ç¬›å¡å°”åæ ‡ç³»</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fd68176f><section class="VPSidebarItem level-0 has-active" data-v-fd68176f data-v-fd6a75f8><div class="item" role="button" tabindex="0" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><h2 class="text" data-v-fd6a75f8>AI</h2><!----></div><div class="items" data-v-fd6a75f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/AI/PromptEngineering.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Prompt Engineering æç¤ºå·¥ç¨‹</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/AI/FunctionCalling.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Function Calling</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/AI/RAGembeddings.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>RAG Embeddings</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/AI/AssistantsApi.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Assistants API</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fd68176f><section class="VPSidebarItem level-0" data-v-fd68176f data-v-fd6a75f8><div class="item" role="button" tabindex="0" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><h2 class="text" data-v-fd6a75f8>Python</h2><!----></div><div class="items" data-v-fd6a75f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Python/LIstAndTuple.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Python listå’Œtuple</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Python/DataTypeAndVars.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Python åŸºç¡€æ•°æ®ç±»å‹å’Œå˜é‡</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fd68176f><section class="VPSidebarItem level-0" data-v-fd68176f data-v-fd6a75f8><div class="item" role="button" tabindex="0" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><h2 class="text" data-v-fd6a75f8>TypeScript</h2><!----></div><div class="items" data-v-fd6a75f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/Function.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript çš„å‡½æ•°ç±»å‹</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/Object.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript çš„å¯¹è±¡ç±»å‹</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/Interface.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript çš„ interface æ¥å£</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/Class.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript çš„Class</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/Generic.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript çš„æ³›å‹</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/Enum.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript çš„Enum</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/TypeAssertion.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript çš„ç±»å‹æ–­è¨€</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/Module.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript æ¨¡å—</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/Namespace.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript namespace</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/Decorator.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript çš„è£…é¥°å™¨</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/DecoratorOld.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript çš„è£…é¥°å™¨(æ—§)</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/Declare.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript declear</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/d.ts.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript d.ts ç±»å‹å£°æ˜æ–‡ä»¶</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/TypeOperatorl.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript ç±»å‹è¿ç®—ç¬¦</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/TypeMapping.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript çš„ç±»å‹æ˜ å°„</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/TypeTools.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript ç±»å‹å·¥å…·</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/CommandLineComplier.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript tsc å‘½ä»¤è¡Œç¼–è¯‘å™¨</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/Annotation.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>TypeScript çš„æ³¨é‡ŠæŒ‡ä»¤</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/TypeScript/Tsconfig.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>tsconfig.json</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fd68176f><section class="VPSidebarItem level-0" data-v-fd68176f data-v-fd6a75f8><div class="item" role="button" tabindex="0" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><h2 class="text" data-v-fd6a75f8>Others</h2><!----></div><div class="items" data-v-fd6a75f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/issues/1.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>tag æ˜¾ç¤ºé—®é¢˜</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/issues/3.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>feed é—®é¢˜</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fd68176f><section class="VPSidebarItem level-0" data-v-fd68176f data-v-fd6a75f8><div class="item" role="button" tabindex="0" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><h2 class="text" data-v-fd6a75f8>git</h2><!----></div><div class="items" data-v-fd6a75f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Git/gitSubmodule.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>gitå­æ¨¡å—</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fd68176f><section class="VPSidebarItem level-0" data-v-fd68176f data-v-fd6a75f8><div class="item" role="button" tabindex="0" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><h2 class="text" data-v-fd6a75f8>JavaScript</h2><!----></div><div class="items" data-v-fd6a75f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Javascript/jsMemory.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>JavaScriptå†…å­˜ç®¡ç†æœºåˆ¶ä¸å…¶ä¸€äº›è¿è¡Œè§„åˆ™</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Javascript/functionalProgramming.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>å‡½æ•°å¼ç¼–ç¨‹</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Javascript/eventFlow&amp;evevtProxy.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>äº‹ä»¶æµä¸äº‹ä»¶å§”æ‰˜</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Javascript/debounce&amp;throttle.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>é˜²æŠ–ä¸èŠ‚æµ</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Javascript/commonlyUsedFunctions.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>ä¸€äº›å¸¸ç”¨å‡½æ•°</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Javascript/V8enginRabish.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>V8å¼•æ“åƒåœ¾å›æ”¶æœºåˆ¶</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fd68176f><section class="VPSidebarItem level-0" data-v-fd68176f data-v-fd6a75f8><div class="item" role="button" tabindex="0" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><h2 class="text" data-v-fd6a75f8>Vue</h2><!----></div><div class="items" data-v-fd6a75f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Vue/vueLifecycle&amp;principle.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Vueå†…éƒ¨è¿è¡Œæœºåˆ¶åŠç”Ÿå‘½å‘¨æœŸ</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Vue/defineproperty&amp;proxy.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Vue2ä¸Vue3ä¸­æ•°æ®å“åº”çš„å®ç°</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fd68176f><section class="VPSidebarItem level-0" data-v-fd68176f data-v-fd6a75f8><div class="item" role="button" tabindex="0" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><h2 class="text" data-v-fd6a75f8>Webpack</h2><!----></div><div class="items" data-v-fd6a75f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Webpack/optimization.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Webpack ä»£ç åˆ†å‰²ï¼Œä»£ç å‹ç¼©</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Webpack/loader-jsComplie.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Webpack å…¨å±€ã€å±€éƒ¨ï¼Œjs-loader</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Webpack/imgloader.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Webpack å›¾ç‰‡ç­‰èµ„æºçš„å¤„ç†</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Webpack/htmlComplie.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Webpack htmlç¼–è¯‘</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Webpack/devServer.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Webpack devServerç›¸å…³é…ç½®</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-fd6a75f8 data-v-fd6a75f8><div class="item" data-v-fd6a75f8><div class="indicator" data-v-fd6a75f8></div><a class="VPLink link link" href="/MyBlog/content/docs/Webpack/bundleSpeedUp.html" data-v-fd6a75f8 data-v-f1e95e09><!--[--><p class="text" data-v-fd6a75f8>Webpack æ‰“åŒ…ä¼˜åŒ–</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPDoc has-aside prose dark:prose-invert" data-v-746cb8a2><!--[--><!--]--><div class="container" data-v-746cb8a2><div class="aside" data-v-746cb8a2><div class="aside-curtain" data-v-746cb8a2></div><div class="aside-container" data-v-746cb8a2><div class="aside-content" data-v-746cb8a2><div class="VPDocAside" data-v-746cb8a2 data-v-abbde929><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-abbde929 data-v-04fb2c57><div class="content" data-v-04fb2c57><div class="outline-marker" data-v-04fb2c57></div><div class="outline-title" data-v-04fb2c57>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-04fb2c57><span class="visually-hidden" id="doc-outline-aria-label" data-v-04fb2c57> Table of Contents for current page </span><ul class="root" data-v-04fb2c57 data-v-b6df4241><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-abbde929></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-746cb8a2><div class="content-container" data-v-746cb8a2><!--[--><div class="not-prose doc-meta"><header class="post-title center"><h1>RAG Embeddings</h1></header><div><div class="page-meta flex items-center flex-col center mt-10 md:mt-6"><div class="dark:text-dark-text/[.86]"><div class="inline-block text-sm mr-4">ğŸ•” 2024-03-13 17:31:39</div><span></span><div class="inline-block"><span class="pl-2 border-solid border-l-2            border-l-blue-1            dark:border-l-white/40            edit-link-border"></span><a class="" href="https://github.com/fzdwx/vitepress-blog-theme/blob/main/content/docs/AI/RAGembeddings.md" target="_blank">âœ </a></div> </div><div class="meta-tag-list flex flex-wrap  mt-3"><!--[--><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded dark:bg-green-900 dark:text-green-300"><a class="" href="/MyBlog/tags?layout=doc&amp;tag=AI">AI</a></span><!--]--></div></div></div></div><!--]--><!----><main class="main" data-v-746cb8a2><div style="position:relative;" class="vp-doc _MyBlog_content_docs_AI_RAGembeddings" data-v-746cb8a2><div><h2 id="llm-å›ºæœ‰çš„å±€é™æ€§" tabindex="-1">LLM å›ºæœ‰çš„å±€é™æ€§ <a class="header-anchor" href="#llm-å›ºæœ‰çš„å±€é™æ€§" aria-label="Permalink to &quot;LLM å›ºæœ‰çš„å±€é™æ€§&quot;">â€‹</a></h2><ul><li>LLM çš„çŸ¥è¯†ä¸æ˜¯å®æ—¶çš„</li><li>LLM å¯èƒ½ä¸çŸ¥é“ä½ ç§æœ‰çš„é¢†åŸŸ/ä¸šåŠ¡çŸ¥è¯†</li></ul><h2 id="æ£€ç´¢å¢å¼ºç”Ÿæˆ-rag-retrieval-augmented-generation" tabindex="-1">æ£€ç´¢å¢å¼ºç”Ÿæˆ RAGï¼ˆRetrieval Augmented Generationï¼‰ <a class="header-anchor" href="#æ£€ç´¢å¢å¼ºç”Ÿæˆ-rag-retrieval-augmented-generation" aria-label="Permalink to &quot;æ£€ç´¢å¢å¼ºç”Ÿæˆ RAGï¼ˆRetrieval Augmented Generationï¼‰&quot;">â€‹</a></h2><p>åŸç†ï¼šå¯ä»¥æŠŠè¿™ä¸ªè¿‡ç¨‹æƒ³è±¡æˆå¼€å·è€ƒè¯•ã€‚è®© LLM å…ˆç¿»ä¹¦ï¼Œå†å›ç­”é—®é¢˜ã€‚</p><img src="/MyBlog/images/ai/RAG.png" width="700"><h2 id="rag-ç³»ç»Ÿçš„åŸºæœ¬æ­å»ºæµç¨‹" tabindex="-1">RAG ç³»ç»Ÿçš„åŸºæœ¬æ­å»ºæµç¨‹ <a class="header-anchor" href="#rag-ç³»ç»Ÿçš„åŸºæœ¬æ­å»ºæµç¨‹" aria-label="Permalink to &quot;RAG ç³»ç»Ÿçš„åŸºæœ¬æ­å»ºæµç¨‹&quot;">â€‹</a></h2><ul><li>æ–‡æ¡£åŠ è½½ï¼Œå¹¶æŒ‰ä¸€å®šæ¡ä»¶åˆ‡å‰²æˆç‰‡æ®µ</li><li>å°†åˆ‡å‰²çš„æ–‡æœ¬ç‰‡æ®µçŒå…¥æ£€ç´¢å¼•æ“</li><li>å°è£…æ£€ç´¢æ¥å£</li><li>æ„å»ºè°ƒç”¨æµç¨‹ï¼šQuery -&gt; æ£€ç´¢ -&gt; Prompt -&gt; LLM -&gt; å›å¤</li></ul><h3 id="æ–‡æ¡£çš„åŠ è½½ä¸åˆ‡å‰²" tabindex="-1">æ–‡æ¡£çš„åŠ è½½ä¸åˆ‡å‰² <a class="header-anchor" href="#æ–‡æ¡£çš„åŠ è½½ä¸åˆ‡å‰²" aria-label="Permalink to &quot;æ–‡æ¡£çš„åŠ è½½ä¸åˆ‡å‰²&quot;">â€‹</a></h3><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># pip install pdfminer.six</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> pdfminer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">high_level </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> extract_pages</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> pdfminer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">layout </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> LTTextContainer</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">extract_text_from_pdf</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">filename</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">page_numbers</span><span style="color:#89DDFF;">=None,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">min_line_length</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># &#39;&#39;&#39;ä» PDF æ–‡ä»¶ä¸­ï¼ˆæŒ‰æŒ‡å®šé¡µç ï¼‰æå–æ–‡å­—&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    paragraphs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span></span>
<span class="line"><span style="color:#A6ACCD;">    buffer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    full_text </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># æå–å…¨éƒ¨æ–‡æœ¬</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> page_layout </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">enumerate</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">extract_pages</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">filename</span><span style="color:#89DDFF;">)):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># å¦‚æœæŒ‡å®šäº†é¡µç èŒƒå›´ï¼Œè·³è¿‡èŒƒå›´å¤–çš„é¡µ</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> page_numbers </span><span style="color:#89DDFF;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> page_numbers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">continue</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> element </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> page_layout</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isinstance</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">element</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> LTTextContainer</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">                full_text </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> element</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_text</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># æŒ‰ç©ºè¡Œåˆ†éš”ï¼Œå°†æ–‡æœ¬é‡æ–°ç»„ç»‡æˆæ®µè½</span></span>
<span class="line"><span style="color:#A6ACCD;">    lines </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> full_text</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> text </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> lines</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">text</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;"> min_line_length</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            buffer </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">text</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> text</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">endswith</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> text</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">strip</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">elif</span><span style="color:#A6ACCD;"> buffer</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            paragraphs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">buffer</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">            buffer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> buffer</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        paragraphs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">buffer</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> paragraphs</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">paragraphs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">extract_text_from_pdf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">é€šåŒ–é‡‘é©¬.pdf</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;font-style:italic;">min_line_length</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> para </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> paragraphs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">para</span><span style="color:#89DDFF;">+</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>è¿”å›ç»“æœï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">äºŒã€å…¬å¸å…³æ³¨å¹¶æ ¸å®çš„ç›¸å…³æƒ…å†µ</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"> é’ˆå¯¹å…¬å¸è‚¡ç¥¨å¼‚å¸¸æ³¢åŠ¨ï¼Œç»é€šè¿‡ç”µè¯ã€ç°åœºé—®è¯¢ç­‰æ–¹å¼å¯¹å…¬å¸æ§è‚¡è‚¡ä¸œã€å®</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"> é™…æ§åˆ¶äººã€è‘£äº‹ä¼šã€ç®¡ç†å±‚è¿›è¡Œæ ¸å®ï¼Œç°å¯¹æœ‰å…³æ ¸å®æƒ…å†µè¯´æ˜å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"> 1ã€å…¬å¸å‰æœŸæŠ«éœ²çš„ä¿¡æ¯æœªå‘ç°éœ€è¦æ›´æ­£ã€è¡¥å……ä¹‹å¤„ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"> 2ã€å…¬å¸æœªå‘ç°è¿‘æœŸå…¬å…±ä¼ åª’æŠ¥é“å¯èƒ½æˆ–å·²ç»å¯¹å…¬å¸è‚¡ç¥¨äº¤æ˜“ä»·æ ¼äº§ç”Ÿè¾ƒå¤§</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"> å½±å“çš„æœªå…¬å¼€é‡å¤§ä¿¡æ¯ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">â€¦â€¦</span></span></code></pre></div><h3 id="æ£€ç´¢å¼•æ“" tabindex="-1">æ£€ç´¢å¼•æ“ <a class="header-anchor" href="#æ£€ç´¢å¼•æ“" aria-label="Permalink to &quot;æ£€ç´¢å¼•æ“&quot;">â€‹</a></h3><p>å…ˆå®ç°ä¸€ä¸ªåŸºç¡€ç‰ˆæ£€ç´¢å¼•æ“</p><p>pip install elasticsearch8 # æœç´¢å¼•æ“æ•°æ®åº“</p><p>pip install nltk # æ–‡æœ¬å¤„ç†æ–¹æ³•åº“</p><p>è‹±æ–‡å…³é”®è¯æå–</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> elasticsearch7 </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Elasticsearch</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> helpers</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> nltk</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">stem </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> PorterStemmer</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> nltk</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tokenize </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> word_tokenize</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> nltk</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">corpus </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> stopwords</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> nltk</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> re</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> warnings</span></span>
<span class="line"><span style="color:#A6ACCD;">warnings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">simplefilter</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ignore</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># å±è”½ ES çš„ä¸€äº›Warnings</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å®éªŒå®¤å¹³å°å·²ç»å†…ç½®</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#nltk.download(&#39;punkt&#39;)  # è‹±æ–‡åˆ‡è¯ã€è¯æ ¹ã€åˆ‡å¥ç­‰æ–¹æ³•</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#nltk.download(&#39;stopwords&#39;)  # è‹±æ–‡åœç”¨è¯åº“</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">to_keywords</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">input_string</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span><span style="color:#676E95;font-style:italic;">ï¼ˆè‹±æ–‡ï¼‰æ–‡æœ¬åªä¿ç•™å…³é”®å­—</span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢æ‰€æœ‰éå­—æ¯æ•°å­—çš„å­—ç¬¦ä¸ºç©ºæ ¼</span></span>
<span class="line"><span style="color:#A6ACCD;">    no_symbols </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> re</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sub</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">r</span><span style="color:#89DDFF;">&#39;[^</span><span style="color:#C3E88D;">a-zA-Z0-9\s</span><span style="color:#89DDFF;">]&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> input_string</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    word_tokens </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">word_tokenize</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">no_symbols</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># åŠ è½½åœç”¨è¯è¡¨</span></span>
<span class="line"><span style="color:#A6ACCD;">    stop_words </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">set</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">stopwords</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">words</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">english</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    ps </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PorterStemmer</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># å»åœç”¨è¯ï¼Œå–è¯æ ¹</span></span>
<span class="line"><span style="color:#A6ACCD;">    filtered_sentence </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">ps</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stem</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">w</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                         </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> w </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> word_tokens </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> w</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">lower</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> stop_words</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">filtered_sentence</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>ä¸­æ–‡å…³é”®è¯æå–</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> re</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> jieba</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> nltk</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> nltk</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">corpus </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> stopwords</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> warnings</span></span>
<span class="line"><span style="color:#A6ACCD;">warnings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">simplefilter</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ignore</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># å±è”½ ES çš„ä¸€äº›Warnings</span></span>
<span class="line"><span style="color:#A6ACCD;">nltk</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">download</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">stopwords</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">to_keywords</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">input_string</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># æŒ‰æœç´¢å¼•æ“æ¨¡å¼åˆ†è¯</span></span>
<span class="line"><span style="color:#A6ACCD;">    word_tokens </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> jieba</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cut_for_search</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">input_string</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># åŠ è½½åœç”¨è¯è¡¨</span></span>
<span class="line"><span style="color:#A6ACCD;">    stop_words </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">set</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">stopwords</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">words</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">chinese</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># å»é™¤åœç”¨è¯</span></span>
<span class="line"><span style="color:#A6ACCD;">    filtered_sentence </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">w </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> w </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> word_tokens </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> w </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> stop_words</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">filtered_sentence</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sent_tokenize</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">input_string</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># æŒ‰æ ‡ç‚¹åˆ‡åˆ†</span></span>
<span class="line"><span style="color:#A6ACCD;">    sentences </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> re</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">r</span><span style="color:#89DDFF;">&#39;(?&lt;=[</span><span style="color:#C3E88D;">ã€‚ï¼ï¼Ÿï¼›?!</span><span style="color:#89DDFF;">])&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> input_string</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># å»æ‰ç©ºå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">sentence </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> sentence </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> sentences </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> sentence</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">strip</span><span style="color:#89DDFF;">()]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> __name__</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># æµ‹è¯•å…³é”®è¯æå–</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">to_keywords</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">å°æ˜ç¡•å£«æ¯•ä¸šäºä¸­å›½ç§‘å­¦é™¢è®¡ç®—æ‰€ï¼Œååœ¨æ—¥æœ¬äº¬éƒ½å¤§å­¦æ·±é€ </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># æµ‹è¯•æ–­å¥</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">sent_tokenize</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">è¿™æ˜¯ï¼Œç¬¬ä¸€å¥ã€‚è¿™æ˜¯ç¬¬äºŒå¥å—ï¼Ÿæ˜¯çš„ï¼å•Š</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">))</span></span></code></pre></div><p>å°†æ–‡æœ¬çŒå…¥æ£€ç´¢å¼•æ“</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> elasticsearch8 </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Elasticsearch</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> helpers</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> ExtractText </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> paragraphs</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> TextCutting </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> to_keywords</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> warnings</span></span>
<span class="line"><span style="color:#A6ACCD;">warnings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">simplefilter</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ignore</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># å±è”½ ES çš„ä¸€äº›Warnings</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 1. åˆ›å»ºElasticsearchè¿æ¥</span></span>
<span class="line"><span style="color:#A6ACCD;">es </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Elasticsearch</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://localhost:9200/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">  </span><span style="color:#676E95;font-style:italic;"># æœåŠ¡åœ°å€ä¸ç«¯å£</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;font-style:italic;">basic_auth</span><span style="color:#89DDFF;">=(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">elastic</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_PebGpTg6*EIgBO2FtzO</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;">  </span><span style="color:#676E95;font-style:italic;"># ç”¨æˆ·åï¼Œå¯†ç </span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 2. å®šä¹‰ç´¢å¼•åç§°</span></span>
<span class="line"><span style="color:#A6ACCD;">index_name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demo</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 3. å¦‚æœç´¢å¼•å·²å­˜åœ¨ï¼Œåˆ é™¤å®ƒï¼ˆä»…ä¾›æ¼”ç¤ºï¼Œå®é™…åº”ç”¨æ—¶ä¸éœ€è¦è¿™æ­¥ï¼‰</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> es</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">indices</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exists</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">index</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">index_name</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        es</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">indices</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">delete</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">index</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">index_name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 4. åˆ›å»ºç´¢å¼•</span></span>
<span class="line"><span style="color:#A6ACCD;">    es</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">indices</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">index</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">index_name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 5. çŒåº“æŒ‡ä»¤</span></span>
<span class="line"><span style="color:#A6ACCD;">    actions </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_index</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> index_name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_source</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">keywords</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">to_keywords</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">para</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> para</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> para </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> paragraphs</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 6. æ–‡æœ¬çŒåº“</span></span>
<span class="line"><span style="color:#A6ACCD;">    helpers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">bulk</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">es</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> actions</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>å®ç°å…³é”®å­—æ£€ç´¢</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> SearchEngine </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> es</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> index_name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> to_keywords</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">search</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">query_string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">top_n</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    keywords </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">to_keywords</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">query_string</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># ES çš„æŸ¥è¯¢è¯­è¨€</span></span>
<span class="line"><span style="color:#A6ACCD;">    search_query </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">match</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">keywords</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> keywords</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> es</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">search</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">index</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">index_name</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">query</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">search_query</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">size</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">top_n</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">hit</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_source</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> hit </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> res</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hits</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hits</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">results </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">search</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3ã€è¿‘æœŸå…¬å¸åœ¨ç ”å›½å®¶ I.I ç±»æ–°è¯ç¥ç€å…«æ°¢æ°¨å–å•¶ç‰‡é¡¹ç›®å¼•èµ·å¸‚åœºå¹¿æ³›å…³æ³¨ï¼Œ</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> r </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> results</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">r</span><span style="color:#89DDFF;">+</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre></div><h3 id="llm-æ¥å£å°è£…" tabindex="-1">LLM æ¥å£å°è£… <a class="header-anchor" href="#llm-æ¥å£å°è£…" aria-label="Permalink to &quot;LLM æ¥å£å°è£…&quot;">â€‹</a></h3><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> openai </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> OpenAI</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> os</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># åŠ è½½ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> dotenv </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> load_dotenv</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> find_dotenv</span></span>
<span class="line"><span style="color:#A6ACCD;">_ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">load_dotenv</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">find_dotenv</span><span style="color:#89DDFF;">())</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># è¯»å–æœ¬åœ° .env æ–‡ä»¶ï¼Œé‡Œé¢å®šä¹‰äº† OPENAI_API_KEY</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">OpenAI</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_completion</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">prompt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">gpt-3.5-turbo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span><span style="color:#676E95;font-style:italic;">å°è£… openai æ¥å£</span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    messages </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">role</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">user</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> prompt</span><span style="color:#89DDFF;">}]</span></span>
<span class="line"><span style="color:#A6ACCD;">    response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">chat</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">completions</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">model</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">messages</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">messages</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">temperature</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">  </span><span style="color:#676E95;font-style:italic;"># æ¨¡å‹è¾“å‡ºçš„éšæœºæ€§ï¼Œ0 è¡¨ç¤ºéšæœºæ€§æœ€å°</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> response</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">choices</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">].</span><span style="color:#F07178;">message</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">content</span></span></code></pre></div><h3 id="prompt-æ¨¡æ¿" tabindex="-1">Prompt æ¨¡æ¿ <a class="header-anchor" href="#prompt-æ¨¡æ¿" aria-label="Permalink to &quot;Prompt æ¨¡æ¿&quot;">â€‹</a></h3><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">prompt_template </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">ä½ æ˜¯ä¸€ä¸ªé—®ç­”æœºå™¨äººã€‚</span></span>
<span class="line"><span style="color:#C3E88D;">ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ä¸‹è¿°ç»™å®šçš„å·²çŸ¥ä¿¡æ¯å›ç­”ç”¨æˆ·é—®é¢˜ã€‚</span></span>
<span class="line"><span style="color:#C3E88D;">ç¡®ä¿ä½ çš„å›å¤å®Œå…¨ä¾æ®ä¸‹è¿°å·²çŸ¥ä¿¡æ¯ã€‚ä¸è¦ç¼–é€ ç­”æ¡ˆã€‚</span></span>
<span class="line"><span style="color:#C3E88D;">å¦‚æœä¸‹è¿°å·²çŸ¥ä¿¡æ¯ä¸è¶³ä»¥å›ç­”ç”¨æˆ·çš„é—®é¢˜ï¼Œè¯·ç›´æ¥å›å¤&quot;æˆ‘æ— æ³•å›ç­”æ‚¨çš„é—®é¢˜&quot;ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">å·²çŸ¥ä¿¡æ¯:</span></span>
<span class="line"><span style="color:#C3E88D;">__INFO__</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">ç”¨æˆ·é—®ï¼š</span></span>
<span class="line"><span style="color:#C3E88D;">__QUERY__</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">è¯·ç”¨ä¸­æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ã€‚</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">build_prompt</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">prompt_template</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">**</span><span style="color:#A6ACCD;font-style:italic;">kwargs</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span><span style="color:#676E95;font-style:italic;">å°† Prompt æ¨¡æ¿èµ‹å€¼</span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    prompt </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> prompt_template</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> k</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> v </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> kwargs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">items</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isinstance</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">v</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">            val </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> v</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">elif</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isinstance</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">v</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#FFCB6B;">list</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">isinstance</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">elem</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#82AAFF;"> elem </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#82AAFF;"> v</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">            val </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">v</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            val </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">v</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        prompt </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> prompt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;__</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">k</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">upper</span><span style="color:#89DDFF;">()</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">__&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> val</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> prompt</span></span></code></pre></div><h3 id="rag-pipeline-åˆæ¢" tabindex="-1">RAG Pipeline åˆæ¢ <a class="header-anchor" href="#rag-pipeline-åˆæ¢" aria-label="Permalink to &quot;RAG Pipeline åˆæ¢&quot;">â€‹</a></h3><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> Search </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> search</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> PromptTemplate </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> build_prompt</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> GptApi </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> get_completion</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">user_query </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">å…¬å¸å«ä»€ä¹ˆåå­—ï¼Ÿ</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 1. æ£€ç´¢</span></span>
<span class="line"><span style="color:#A6ACCD;">search_results </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">search</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">user_query</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 2. æ„å»º Prompt</span></span>
<span class="line"><span style="color:#A6ACCD;">prompt </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">build_prompt</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">info</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">search_results</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">query</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">user_query</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">===Prompt===</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">prompt</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 3. è°ƒç”¨ LLM</span></span>
<span class="line"><span style="color:#A6ACCD;">response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_completion</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">prompt</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">===å›å¤===</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">response</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>è¿”å›ç»“æœ</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">===Prompt===</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">ä½ æ˜¯ä¸€ä¸ªé—®ç­”æœºå™¨äººã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;">ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ä¸‹è¿°ç»™å®šçš„å·²çŸ¥ä¿¡æ¯å›ç­”ç”¨æˆ·é—®é¢˜ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;">ç¡®ä¿ä½ çš„å›å¤å®Œå…¨ä¾æ®ä¸‹è¿°å·²çŸ¥ä¿¡æ¯ã€‚ä¸è¦ç¼–é€ ç­”æ¡ˆã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;">å¦‚æœä¸‹è¿°å·²çŸ¥ä¿¡æ¯ä¸è¶³ä»¥å›ç­”ç”¨æˆ·çš„é—®é¢˜ï¼Œè¯·ç›´æ¥å›å¤&quot;æˆ‘æ— æ³•å›ç­”æ‚¨çš„é—®é¢˜&quot;ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">å·²çŸ¥ä¿¡æ¯:</span></span>
<span class="line"><span style="color:#A6ACCD;"> é™¤ä¸Šè¿°äº‹é¡¹å¤–ï¼Œå…¬å¸ã€å…¬å¸æ§è‚¡è‚¡ä¸œã€å®é™…æ§åˆ¶äººç›®å‰ä¸å­˜åœ¨å…³äºæœ¬å…¬å¸çš„</span></span>
<span class="line"><span style="color:#A6ACCD;"> ä¹°å–å…¬å¸è‚¡ç¥¨æƒ…å†µã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"> å–å•¶ç‰‡ III æœŸä¸´åºŠè¯•éªŒç›²æ€æ•°æ®å®¡æ ¸çš„å…¬å‘Šã€‹ï¼Œé›†å›¢å…¬å¸åŠå…¨èµ„å­å…¬å¸é•¿æ˜¥åæ´‹</span></span>
<span class="line"><span style="color:#A6ACCD;"> é’ˆå¯¹å…¬å¸è‚¡ç¥¨å¼‚å¸¸æ³¢åŠ¨ï¼Œç»é€šè¿‡ç”µè¯ã€ç°åœºé—®è¯¢ç­‰æ–¹å¼å¯¹å…¬å¸æ§è‚¡è‚¡ä¸œã€å®</span></span>
<span class="line"><span style="color:#A6ACCD;"> éœ²è€ŒæœªæŠ«éœ²çš„ã€å¯¹æœ¬å…¬å¸è‚¡ç¥¨åŠå…¶è¡ç”Ÿå“ç§äº¤æ˜“ä»·æ ¼äº§ç”Ÿè¾ƒå¤§å½±å“çš„ä¿¡æ¯ï¼›å…¬å¸</span></span>
<span class="line"><span style="color:#A6ACCD;"> 2ã€å…¬å¸æœªå‘ç°è¿‘æœŸå…¬å…±ä¼ åª’æŠ¥é“å¯èƒ½æˆ–å·²ç»å¯¹å…¬å¸è‚¡ç¥¨äº¤æ˜“ä»·æ ¼äº§ç”Ÿè¾ƒå¤§</span></span>
<span class="line"><span style="color:#A6ACCD;"> æœ¬å…¬å¸è‘£äº‹ä¼šç¡®è®¤ï¼Œé™¤å‰è¿°äº‹é¡¹å¤–ï¼Œæœ¬å…¬å¸ç›®å‰æ²¡æœ‰ä»»ä½•æ ¹æ®æ·±äº¤æ‰€ã€Šè‚¡ç¥¨</span></span>
<span class="line"><span style="color:#A6ACCD;"> 1ã€ç»è‡ªæŸ¥ï¼Œå…¬å¸ä¸å­˜åœ¨è¿åä¿¡æ¯å…¬å¹³æŠ«éœ²çš„æƒ…å½¢ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"> é€šåŒ–é‡‘é©¬è¯ä¸šé›†å›¢è‚¡ä»½æœ‰é™å…¬å¸è‘£äº‹ä¼š</span></span>
<span class="line"><span style="color:#A6ACCD;"> äºŒã€å…¬å¸å…³æ³¨å¹¶æ ¸å®çš„ç›¸å…³æƒ…å†µ</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">ç”¨æˆ·é—®ï¼š</span></span>
<span class="line"><span style="color:#A6ACCD;">å…¬å¸å«ä»€ä¹ˆåå­—ï¼Ÿ</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">è¯·ç”¨ä¸­æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">===å›å¤===</span></span>
<span class="line"><span style="color:#A6ACCD;">å…¬å¸å«é€šåŒ–é‡‘é©¬è¯ä¸šé›†å›¢è‚¡ä»½æœ‰é™å…¬å¸ã€‚</span></span></code></pre></div><h3 id="å…³é”®å­—æ£€ç´¢çš„å±€é™æ€§" tabindex="-1">å…³é”®å­—æ£€ç´¢çš„å±€é™æ€§ <a class="header-anchor" href="#å…³é”®å­—æ£€ç´¢çš„å±€é™æ€§" aria-label="Permalink to &quot;å…³é”®å­—æ£€ç´¢çš„å±€é™æ€§&quot;">â€‹</a></h3><p>å› ä¸ºæ˜¯é€å­—åŒ¹é…æ‰€ä»¥ï¼Œå¦‚æœæ˜¯åŒä¸€ä¸ªé—®é¢˜æ¢ä¸€ä¸ªè¯´æ³•ï¼Œå¯èƒ½å¯¼è‡´æ£€ç´¢ä¸åˆ°ç»“æœã€‚</p><h2 id="å‘é‡æ£€ç´¢" tabindex="-1">å‘é‡æ£€ç´¢ <a class="header-anchor" href="#å‘é‡æ£€ç´¢" aria-label="Permalink to &quot;å‘é‡æ£€ç´¢&quot;">â€‹</a></h2><h3 id="æ–‡æœ¬å‘é‡-text-embeddings" tabindex="-1">æ–‡æœ¬å‘é‡ï¼ˆText Embeddingsï¼‰ <a class="header-anchor" href="#æ–‡æœ¬å‘é‡-text-embeddings" aria-label="Permalink to &quot;æ–‡æœ¬å‘é‡ï¼ˆText Embeddingsï¼‰&quot;">â€‹</a></h3><ol><li>å°†æ–‡æœ¬è½¬æˆä¸€ç»„æµ®ç‚¹æ•°ï¼šæ¯ä¸ªä¸‹æ ‡ iï¼Œå¯¹åº”ä¸€ä¸ªç»´åº¦</li><li>æ•´ä¸ªæ•°ç»„å¯¹åº”ä¸€ä¸ª n ç»´ç©ºé—´çš„ä¸€ä¸ªç‚¹ï¼Œå³<strong>æ–‡æœ¬å‘é‡</strong>åˆå« Embeddings</li><li>å‘é‡ä¹‹é—´å¯ä»¥è®¡ç®—è·ç¦»ï¼Œè·ç¦»è¿œè¿‘å¯¹åº”<strong>è¯­ä¹‰ç›¸ä¼¼åº¦</strong>å¤§å°</li></ol><img src="/MyBlog/images/ai/embeddings.png" width="700px"><h3 id="æ–‡æœ¬å‘é‡æ˜¯æ€ä¹ˆå¾—åˆ°çš„-ç®€å•äº†è§£" tabindex="-1">æ–‡æœ¬å‘é‡æ˜¯æ€ä¹ˆå¾—åˆ°çš„ï¼ˆç®€å•äº†è§£ï¼‰ <a class="header-anchor" href="#æ–‡æœ¬å‘é‡æ˜¯æ€ä¹ˆå¾—åˆ°çš„-ç®€å•äº†è§£" aria-label="Permalink to &quot;æ–‡æœ¬å‘é‡æ˜¯æ€ä¹ˆå¾—åˆ°çš„ï¼ˆç®€å•äº†è§£ï¼‰&quot;">â€‹</a></h3><ol><li>æ„å»ºç›¸å…³ï¼ˆæ­£ç«‹ï¼‰ä¸ä¸ç›¸å…³ï¼ˆè´Ÿä¾‹ï¼‰çš„å¥å­å¯¹å„¿æ ·æœ¬</li><li>è®­ç»ƒåŒå¡”å¼æ¨¡å‹ï¼Œè®©æ­£ä¾‹é—´çš„è·ç¦»å°ï¼Œè´Ÿä¾‹é—´çš„è·ç¦»å¤§</li></ol><p>ä¾‹å¦‚ï¼š</p><img src="/MyBlog/images/ai/sbert.png" width="700px"><p>æ‰©å±•é˜…è¯»ï¼š<a href="https://www.sbert.net" target="_blank" rel="noreferrer">https://www.sbert.net</a></p><h3 id="å‘é‡é—´çš„ç›¸ä¼¼åº¦è®¡ç®—" tabindex="-1">å‘é‡é—´çš„ç›¸ä¼¼åº¦è®¡ç®— <a class="header-anchor" href="#å‘é‡é—´çš„ç›¸ä¼¼åº¦è®¡ç®—" aria-label="Permalink to &quot;å‘é‡é—´çš„ç›¸ä¼¼åº¦è®¡ç®—&quot;">â€‹</a></h3><img src="/MyBlog/images/ai/sim.png" width="700px"><p>è°ƒç”¨openAIçš„Embeddingsæ¨¡å‹</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_embeddings</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">texts</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text-embedding-ada-002</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">dimensions</span><span style="color:#89DDFF;">=None):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span><span style="color:#676E95;font-style:italic;">å°è£… OpenAI çš„ Embedding æ¨¡å‹æ¥å£</span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> model </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text-embedding-ada-002</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        dimensions </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> dimensions</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">embeddings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">input</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">texts</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">model</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">dimensions</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">dimensions</span><span style="color:#89DDFF;">).</span><span style="color:#F07178;">data</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">embeddings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">input</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">texts</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">model</span><span style="color:#89DDFF;">).</span><span style="color:#F07178;">data</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">embedding</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> data</span><span style="color:#89DDFF;">]</span></span></code></pre></div><p>å°è£…è®¡ç®—æ¬§å¼è·ç¦»ï¼Œä½™å¼¦è·ç¦»çš„å‡½æ•°</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> numpy </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> np</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> numpy </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> dot</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> numpy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">linalg </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> norm</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cos_sim</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span><span style="color:#676E95;font-style:italic;">ä½™å¼¦è·ç¦» -- è¶Šå¤§è¶Šç›¸ä¼¼</span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">dot</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">a</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> b</span><span style="color:#89DDFF;">)/(</span><span style="color:#82AAFF;">norm</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">a</span><span style="color:#89DDFF;">)*</span><span style="color:#82AAFF;">norm</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">b</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">l2</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span><span style="color:#676E95;font-style:italic;">æ¬§å¼è·ç¦» -- è¶Šå°è¶Šç›¸ä¼¼</span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">asarray</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">a</span><span style="color:#89DDFF;">)-</span><span style="color:#A6ACCD;">np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">asarray</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">b</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">norm</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">x</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>åšä¸€äº›å°æµ‹è¯•</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">test_query </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">æµ‹è¯•æ–‡æœ¬</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">vec </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_embeddings</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">test_query</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">vec</span><span style="color:#89DDFF;">[:</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">vec</span><span style="color:#89DDFF;">))</span></span></code></pre></div><p>è¿”å›ç»“æœ</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[-0.007280634716153145, -0.006147929932922125, -0.010664181783795357, 0.001484171487390995, -0.010678750462830067, 0.029253656044602394, -0.01976952701807022, 0.005444996990263462, -0.01687038503587246, -0.01207733154296875]</span></span>
<span class="line"><span style="color:#A6ACCD;">1536</span></span></code></pre></div><br><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># query = &quot;å›½é™…äº‰ç«¯&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ä¸”èƒ½æ”¯æŒè·¨è¯­è¨€</span></span>
<span class="line"><span style="color:#A6ACCD;">query </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">global conflicts</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">documents </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">è”åˆå›½å°±è‹ä¸¹è¾¾å°”å¯Œå°”åœ°åŒºå¤§è§„æ¨¡æš´åŠ›äº‹ä»¶å‘å‡ºè­¦å‘Š</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">åœŸè€³å…¶ã€èŠ¬å…°ã€ç‘å…¸ä¸åŒ—çº¦ä»£è¡¨å°†ç»§ç»­å°±ç‘å…¸â€œå…¥çº¦â€é—®é¢˜è¿›è¡Œè°ˆåˆ¤</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">æ—¥æœ¬å²é˜œå¸‚é™†ä¸Šè‡ªå«é˜Ÿå°„å‡»åœºå†…å‘ç”Ÿæªå‡»äº‹ä»¶ 3äººå—ä¼¤</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">å›½å®¶æ¸¸æ³³ä¸­å¿ƒï¼ˆæ°´ç«‹æ–¹ï¼‰ï¼šæ¢å¤æ¸¸æ³³ã€å¬‰æ°´ä¹å›­ç­‰æ°´ä¸Šé¡¹ç›®è¿è¥</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">æˆ‘å›½é¦–æ¬¡åœ¨ç©ºé—´ç«™å¼€å±•èˆ±å¤–è¾å°„ç”Ÿç‰©å­¦æš´éœ²å®éªŒ</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">query_vec </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_embeddings</span><span style="color:#89DDFF;">([</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">])[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">doc_vecs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_embeddings</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">documents</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cosine distance:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">cos_sim</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">query_vec</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> query_vec</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> vec </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> doc_vecs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">cos_sim</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">query_vec</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> vec</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\n</span><span style="color:#C3E88D;">Euclidean distance:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">l2</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">query_vec</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> query_vec</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> vec </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> doc_vecs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">l2</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">query_vec</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> vec</span><span style="color:#89DDFF;">))</span></span></code></pre></div><p>è¿”å›ç»“æœ</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Cosine distance:</span></span>
<span class="line"><span style="color:#A6ACCD;">1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">0.7622749944010915</span></span>
<span class="line"><span style="color:#A6ACCD;">0.7563038106493584</span></span>
<span class="line"><span style="color:#A6ACCD;">0.7426665802579038</span></span>
<span class="line"><span style="color:#A6ACCD;">0.7079273699608006</span></span>
<span class="line"><span style="color:#A6ACCD;">0.7254355321045072</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">Euclidean distance:</span></span>
<span class="line"><span style="color:#A6ACCD;">0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">0.6895288502682277</span></span>
<span class="line"><span style="color:#A6ACCD;">0.6981349637998769</span></span>
<span class="line"><span style="color:#A6ACCD;">0.7174028746492277</span></span>
<span class="line"><span style="color:#A6ACCD;">0.7642939833636829</span></span>
<span class="line"><span style="color:#A6ACCD;">0.7410323668625171</span></span></code></pre></div><h3 id="å‘é‡æ•°æ®åº“" tabindex="-1">å‘é‡æ•°æ®åº“ <a class="header-anchor" href="#å‘é‡æ•°æ®åº“" aria-label="Permalink to &quot;å‘é‡æ•°æ®åº“&quot;">â€‹</a></h3><p>å‘é‡æ•°æ®åº“ï¼Œæ˜¯ä¸“é—¨ä¸ºå‘é‡æ£€ç´¢è®¾è®¡çš„ä¸­é—´ä»¶</p><p>pip install chromadb</p><p>ç”¨chromaä½œä¸ºå‘é‡æ•°æ®åº“</p><p>chroma run --path /db_path å¯åŠ¨æ•°æ®åº“</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> chromadb</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyVectorDBConnector</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">__init__</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">collection_name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">embedding_fn</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        chroma_client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> chromadb</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">HttpClient</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">host</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">8000</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># ä¸ºäº†æ¼”ç¤ºï¼Œå®é™…ä¸éœ€è¦æ¯æ¬¡ reset()</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># chroma_client.reset()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># åˆ›å»ºä¸€ä¸ª collection</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">collection</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> chroma_client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_or_create_collection</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">collection_name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">embedding_fn</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> embedding_fn</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">add_documents</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">documents</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># &#39;&#39;&#39;å‘ collection ä¸­æ·»åŠ æ–‡æ¡£ä¸å‘é‡&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">documents</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">collection</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">embeddings</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">embedding_fn</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">documents</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;">  </span><span style="color:#676E95;font-style:italic;"># æ¯ä¸ªæ–‡æ¡£çš„å‘é‡</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">documents</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">documents</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">  </span><span style="color:#676E95;font-style:italic;"># æ–‡æ¡£çš„åŸæ–‡</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">ids</span><span style="color:#89DDFF;">=[</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;id</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">i</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#82AAFF;"> i </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#82AAFF;"> range</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">documents</span><span style="color:#89DDFF;">))]</span><span style="color:#82AAFF;">  </span><span style="color:#676E95;font-style:italic;"># æ¯ä¸ªæ–‡æ¡£çš„ id</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">search</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">query</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">top_n</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># &#39;&#39;&#39;æ£€ç´¢å‘é‡æ•°æ®åº“&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">        results </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">collection</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">query_embeddings</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">embedding_fn</span><span style="color:#89DDFF;">([</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">]),</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">n_results</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">top_n</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> results</span></span></code></pre></div><br><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># åˆ›å»ºä¸€ä¸ªå‘é‡æ•°æ®åº“å¯¹è±¡</span></span>
<span class="line"><span style="color:#A6ACCD;">vector_db </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MyVectorDBConnector</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> get_embeddings</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å‘å‘é‡æ•°æ®åº“ä¸­æ·»åŠ æ–‡æ¡£</span></span>
<span class="line"><span style="color:#A6ACCD;">vector_db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_documents</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">paragraphs</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> VectorDB </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> vector_db</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">user_query </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">å…¬å¸çš„åå­—</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">results </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> vector_db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">search</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">user_query</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> para </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> results</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">documents</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">para</span><span style="color:#89DDFF;">+</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre></div><h3 id="ä¸»æµå‘é‡æ•°æ®åº“åŠŸèƒ½å¯¹æ¯”" tabindex="-1">ä¸»æµå‘é‡æ•°æ®åº“åŠŸèƒ½å¯¹æ¯” <a class="header-anchor" href="#ä¸»æµå‘é‡æ•°æ®åº“åŠŸèƒ½å¯¹æ¯”" aria-label="Permalink to &quot;ä¸»æµå‘é‡æ•°æ®åº“åŠŸèƒ½å¯¹æ¯”&quot;">â€‹</a></h3><img src="/MyBlog/images/ai/vectordb.png" width="700px/"><ul><li>FAISS: Meta å¼€æºçš„å‘é‡æ£€ç´¢å¼•æ“ <a href="https://github.com/facebookresearch/faiss" target="_blank" rel="noreferrer">https://github.com/facebookresearch/faiss</a></li><li>Pinecone: å•†ç”¨å‘é‡æ•°æ®åº“ï¼Œåªæœ‰äº‘æœåŠ¡ <a href="https://www.pinecone.io/" target="_blank" rel="noreferrer">https://www.pinecone.io/</a></li><li>Milvus: å¼€æºå‘é‡æ•°æ®åº“ï¼ŒåŒæ—¶æœ‰äº‘æœåŠ¡ <a href="https://milvus.io/" target="_blank" rel="noreferrer">https://milvus.io/</a></li><li>Weaviate: å¼€æºå‘é‡æ•°æ®åº“ï¼ŒåŒæ—¶æœ‰äº‘æœåŠ¡ <a href="https://weaviate.io/" target="_blank" rel="noreferrer">https://weaviate.io/</a></li><li>Qdrant: å¼€æºå‘é‡æ•°æ®åº“ï¼ŒåŒæ—¶æœ‰äº‘æœåŠ¡ <a href="https://qdrant.tech/" target="_blank" rel="noreferrer">https://qdrant.tech/</a></li><li>PGVector: Postgres çš„å¼€æºå‘é‡æ£€ç´¢å¼•æ“ <a href="https://github.com/pgvector/pgvector" target="_blank" rel="noreferrer">https://github.com/pgvector/pgvector</a></li><li>RediSearch: Redis çš„å¼€æºå‘é‡æ£€ç´¢å¼•æ“ <a href="https://github.com/RediSearch/RediSearch" target="_blank" rel="noreferrer">https://github.com/RediSearch/RediSearch</a></li><li>ElasticSearch ä¹Ÿæ”¯æŒå‘é‡æ£€ç´¢ <a href="https://www.elastic.co/enterprise-search/vector-search" target="_blank" rel="noreferrer">https://www.elastic.co/enterprise-search/vector-search</a></li></ul><h3 id="åŸºäºå‘é‡æ£€ç´¢çš„-rag" tabindex="-1">åŸºäºå‘é‡æ£€ç´¢çš„ RAG <a class="header-anchor" href="#åŸºäºå‘é‡æ£€ç´¢çš„-rag" aria-label="Permalink to &quot;åŸºäºå‘é‡æ£€ç´¢çš„ RAG&quot;">â€‹</a></h3><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">RAG_Bot</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">__init__</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">vector_db</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">llm_api</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">n_results</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">vector_db</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> vector_db</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">llm_api</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> llm_api</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">n_results</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> n_results</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">chat</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">user_query</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># 1. æ£€ç´¢</span></span>
<span class="line"><span style="color:#A6ACCD;">        search_results </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">vector_db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">search</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">user_query</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">n_results</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># 2. æ„å»º Prompt</span></span>
<span class="line"><span style="color:#A6ACCD;">        prompt </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">build_prompt</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">info</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">search_results</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">documents</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">query</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">user_query</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">===Prompt===</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">prompt</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># 3. è°ƒç”¨ LLM</span></span>
<span class="line"><span style="color:#A6ACCD;">        response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">llm_api</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">prompt</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> response</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># åˆ›å»ºä¸€ä¸ªRAGæœºå™¨äºº</span></span>
<span class="line"><span style="color:#A6ACCD;">bot </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RAG_Bot</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    vector_db</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;font-style:italic;">llm_api</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">get_completion</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">user_query </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">æ–‡ç« å‘å¸ƒæ—¶é—´æ˜¯ï¼Ÿ</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> bot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">chat</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">user_query</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">response</span><span style="color:#89DDFF;">)</span></span></code></pre></div><h3 id="å›½äº§å¤§æ¨¡å‹" tabindex="-1">å›½äº§å¤§æ¨¡å‹ <a class="header-anchor" href="#å›½äº§å¤§æ¨¡å‹" aria-label="Permalink to &quot;å›½äº§å¤§æ¨¡å‹&quot;">â€‹</a></h3><p>embedding æ¨¡å‹ï¼Œç™¾åº¦åƒå¸† bge_large_zhï¼› chatï¼Œè°ƒç”¨æ–‡å¿ƒ4.0å¯¹è¯æ¥å£ã€‚</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> json</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> requests</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> os</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># åŠ è½½ .env åˆ°ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> dotenv </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> load_dotenv</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> find_dotenv</span></span>
<span class="line"><span style="color:#A6ACCD;">_ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">load_dotenv</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">find_dotenv</span><span style="color:#89DDFF;">())</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># é€šè¿‡é‰´æƒæ¥å£è·å– access token</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_access_token</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># ä½¿ç”¨ AKï¼ŒSK ç”Ÿæˆé‰´æƒç­¾åï¼ˆAccess Tokenï¼‰</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># :return: access_tokenï¼Œæˆ–æ˜¯None(å¦‚æœé”™è¯¯)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://aip.baidubce.com/oauth/2.0/token</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    params </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">grant_type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">client_credentials</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">client_id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getenv</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ERNIE_CLIENT_ID</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">client_secret</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getenv</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ERNIE_CLIENT_SECRET</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">params</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">params</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">json</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">access_token</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è°ƒç”¨æ–‡å¿ƒåƒå¸† è°ƒç”¨ BGE Embedding æ¥å£</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_embeddings_bge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">prompts</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/embeddings/bge_large_zh?access_token=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_access_token</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    payload </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> json</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dumps</span><span style="color:#89DDFF;">({</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">input</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> prompts</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">    headers </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Content-Type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">application/json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">request</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> url</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">headers</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">headers</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">payload</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">json</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> response</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">embedding</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> data</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è°ƒç”¨æ–‡å¿ƒ4.0å¯¹è¯æ¥å£</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_completion_ernie</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">prompt</span><span style="color:#89DDFF;">):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/completions_pro?access_token=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_access_token</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    payload </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> json</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dumps</span><span style="color:#89DDFF;">({</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">messages</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">role</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">user</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> prompt</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    headers </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Content-Type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">application/json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">request</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> url</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">headers</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">headers</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">payload</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">json</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> response</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">result</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_embeddings_bge</span><span style="color:#89DDFF;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ä¸€äºŒä¸‰å››äº”</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">res</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]))</span></span></code></pre></div><br><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># åˆ›å»ºä¸€ä¸ªRAGæœºå™¨äºº</span></span>
<span class="line"><span style="color:#A6ACCD;">bot </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RAG_Bot</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">vector_db</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">llm_api</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">get_completion_ernie</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">n_results</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">query </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">æ–‡ç« å‘å¸ƒä¸»ä½“æ˜¯ä»€ä¹ˆå…¬å¸ï¼Ÿ</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> bot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">chat</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">===å›å¤===</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">response</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>è¿”å›ç»“æœ</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">===Prompt===</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">ä½ æ˜¯ä¸€ä¸ªé—®ç­”æœºå™¨äººã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;">ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ä¸‹è¿°ç»™å®šçš„å·²çŸ¥ä¿¡æ¯å›ç­”ç”¨æˆ·é—®é¢˜ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;">ç¡®ä¿ä½ çš„å›å¤å®Œå…¨ä¾æ®ä¸‹è¿°å·²çŸ¥ä¿¡æ¯ã€‚ä¸è¦ç¼–é€ ç­”æ¡ˆã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;">å¦‚æœä¸‹è¿°å·²çŸ¥ä¿¡æ¯ä¸è¶³ä»¥å›ç­”ç”¨æˆ·çš„é—®é¢˜ï¼Œè¯·ç›´æ¥å›å¤&quot;æˆ‘æ— æ³•å›ç­”æ‚¨çš„é—®é¢˜&quot;ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">å·²çŸ¥ä¿¡æ¯:</span></span>
<span class="line"><span style="color:#A6ACCD;"> è‚¡ç¥¨äº¤æ˜“å¼‚å¸¸æ³¢åŠ¨å…¬å‘Š</span></span>
<span class="line"><span style="color:#A6ACCD;"> å–å•¶ç‰‡ III æœŸä¸´åºŠè¯•éªŒç›²æ€æ•°æ®å®¡æ ¸çš„å…¬å‘Šã€‹ï¼Œé›†å›¢å…¬å¸åŠå…¨èµ„å­å…¬å¸é•¿æ˜¥åæ´‹</span></span>
<span class="line"><span style="color:#A6ACCD;"> å¤§æŠ•èµ„è€…ï¼Œè‚¡ç¥¨ä»·æ ¼å¯èƒ½å—åˆ°å®è§‚ç»æµã€å¸‚åœºç¯å¢ƒã€è¡Œä¸šå‘å±•ã€å…¬å¸ç»è¥æƒ…å†µåŠ</span></span>
<span class="line"><span style="color:#A6ACCD;"> é€šåŒ–é‡‘é©¬è¯ä¸šé›†å›¢è‚¡ä»½æœ‰é™å…¬å¸</span></span>
<span class="line"><span style="color:#A6ACCD;"> 2ã€ç›®å‰å…¬å¸ç»è¥æƒ…å†µåŠå†…å¤–éƒ¨ç»è¥ç¯å¢ƒæœªå‘ç”Ÿé‡å¤§å˜åŒ–ã€‚å…¬å¸éƒ‘é‡æé†’å¹¿</span></span>
<span class="line"><span style="color:#A6ACCD;"> æŠ•èµ„è€…åå¥½ç­‰å¤šé‡å› ç´ å½±å“ï¼Œæ•¬è¯·å¹¿å¤§æŠ•èµ„è€…æ³¨æ„äº¤æ˜“é£é™©ï¼Œå®¡æ…å†³ç­–ã€ç†æ€§æŠ•</span></span>
<span class="line"><span style="color:#A6ACCD;"> æœ¬å…¬å¸åŠè‘£äº‹ä¼šå…¨ä½“æˆå‘˜ä¿è¯ä¿¡æ¯æŠ«éœ²çš„å†…å®¹çœŸå®ã€å‡†ç¡®ã€å®Œæ•´ï¼Œæ²¡æœ‰è™šå‡</span></span>
<span class="line"><span style="color:#A6ACCD;"> 3ã€2023 å¹´ 8 æœˆ 31 æ—¥ï¼Œå…¬å¸æŠ«éœ²äº†ã€Šå…³äºå®Œæˆå›½å®¶ I.I ç±»æ–°è¯ç¥ç€å…«æ°¢æ°¨</span></span>
<span class="line"><span style="color:#A6ACCD;"> 20%ã€‚æ ¹æ®æ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€çš„æœ‰å…³è§„å®šï¼Œè¯¥æƒ…å½¢å±äºè‚¡ç¥¨äº¤æ˜“å¼‚å¸¸æ³¢åŠ¨çš„æƒ…å†µã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"> è®°è½½ã€è¯¯å¯¼æ€§é™ˆè¿°æˆ–é‡å¤§é—æ¼ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"> è¯åˆ¸ä»£ç ï¼š000766        è¯åˆ¸ç®€ç§°ï¼šé€šåŒ–é‡‘é©¬        å…¬å‘Šç¼–å·ï¼š2023-47</span></span>
<span class="line"><span style="color:#A6ACCD;"> æ”¿ç­–ç­‰å¤šæ–¹é¢å› ç´ çš„å½±å“ï¼Œè¯æ”¿è¯„å®¡å†³ç­–ã€ç›¸å…³ç ”å‘è¿›å±•åŠæœªæ¥äº§å“å¸‚åœºç«äº‰å½¢</span></span>
<span class="line"><span style="color:#A6ACCD;"> åºŠæˆç›²æ€æ•°æ®å®¡æ ¸ã€‚ä½†æ–°è¯ç ”å‘å°¤å…¶æ˜¯å›½å®¶ I.I ç±»æ–°è¯çš„ç ”å‘å—åˆ°æŠ€æœ¯ã€å®¡æ‰¹ã€</span></span>
<span class="line"><span style="color:#A6ACCD;"> 1ã€é€šåŒ–é‡‘é©¬è¯ä¸šé›†å›¢è‚¡ä»½æœ‰é™å…¬å¸ï¼ˆä»¥ä¸‹ç®€ç§°â€œå…¬å¸â€ï¼‰è‚¡ç¥¨äº¤æ˜“ä»·æ ¼è¿ç»­</span></span>
<span class="line"><span style="color:#A6ACCD;"> äºŒä¸ªäº¤æ˜“æ—¥ï¼ˆ2023 å¹´ 9 æœˆ 13 æ—¥ã€9 æœˆ 14 æ—¥ï¼‰æ—¥æ”¶ç›˜ä»·æ ¼æ¶¨å¹…åç¦»å€¼ç´¯è®¡è¶…è¿‡</span></span>
<span class="line"><span style="color:#A6ACCD;"> é«˜ç§‘æŠ€æœ‰é™å…¬å¸è‡ªä¸»ç ”å‘ã€å…·æœ‰ç‹¬å®¶ä¸“åˆ©çš„ç¥ç€å…«æ°¢æ°¨å–å•¶ç‰‡å·²ç»å®Œæˆ III æœŸä¸´</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">ç”¨æˆ·é—®ï¼š</span></span>
<span class="line"><span style="color:#A6ACCD;">æ–‡ç« å‘å¸ƒä¸»ä½“æ˜¯ä»€ä¹ˆå…¬å¸ï¼Ÿ</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">è¯·ç”¨ä¸­æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">===å›å¤===</span></span>
<span class="line"><span style="color:#A6ACCD;">æ–‡ç« å‘å¸ƒä¸»ä½“æ˜¯é€šåŒ–é‡‘é©¬è¯ä¸šé›†å›¢è‚¡ä»½æœ‰é™å…¬å¸ã€‚</span></span></code></pre></div><p>æ–‡æœ¬å‘é‡åŒ–çš„æ¥å£ï¼Œæ–‡æœ¬å‚æ•°æœ‰é•¿åº¦é™åˆ¶ï¼Œæœ€å¤§16ã€‚ä¸­æ–‡çš„æ•ˆæœä¼¼ä¹è¦æ¯”openaiçš„å¥½ã€‚</p><h3 id="openai-æ–°å‘å¸ƒçš„ä¸¤ä¸ª-embedding-æ¨¡å‹" tabindex="-1">OpenAI æ–°å‘å¸ƒçš„ä¸¤ä¸ª Embedding æ¨¡å‹ <a class="header-anchor" href="#openai-æ–°å‘å¸ƒçš„ä¸¤ä¸ª-embedding-æ¨¡å‹" aria-label="Permalink to &quot;OpenAI æ–°å‘å¸ƒçš„ä¸¤ä¸ª Embedding æ¨¡å‹&quot;">â€‹</a></h3><p>2024å¹´1æœˆ25æ—¥ï¼ŒOpenAI æ–°å‘å¸ƒäº†ä¸¤ä¸ª Embedding æ¨¡å‹</p><ul><li>text-embedding-3-large</li><li>text-embedding-3-small</li></ul><p>å…¶æœ€å¤§ç‰¹ç‚¹æ˜¯ï¼Œæ”¯æŒè‡ªå®šä¹‰çš„ç¼©çŸ­å‘é‡ç»´åº¦ï¼Œä»è€Œåœ¨å‡ ä¹ä¸å½±å“æœ€ç»ˆæ•ˆæœçš„æƒ…å†µä¸‹é™ä½å‘é‡æ£€ç´¢ä¸ç›¸ä¼¼åº¦è®¡ç®—çš„å¤æ‚åº¦ã€‚</p><p>é€šä¿—çš„è¯´ï¼š<strong>è¶Šå¤§è¶Šå‡†ã€è¶Šå°è¶Šå¿«ã€‚</strong> å®˜æ–¹å…¬å¸ƒçš„è¯„æµ‹ç»“æœ:</p><img src="/MyBlog/images/ai/mteb.png" width="700px"><p>æ³¨ï¼š<a href="https://huggingface.co/blog/mteb" target="_blank" rel="noreferrer">MTEB</a> æ˜¯ä¸€ä¸ªå¤§è§„æ¨¡å¤šä»»åŠ¡çš„ Embedding æ¨¡å‹å…¬å¼€è¯„æµ‹é›†</p><p>æ‰©å±•é˜…è¯»ï¼šè¿™ç§å¯å˜é•¿åº¦çš„ Embedding æŠ€æœ¯èƒŒåçš„åŸç†å«åš <a href="https://arxiv.org/abs/2205.13147" target="_blank" rel="noreferrer">Matryoshka Representation Learning</a></p><h2 id="å®æˆ˜-rag-ç³»ç»Ÿçš„è¿›é˜¶çŸ¥è¯†" tabindex="-1">å®æˆ˜ RAG ç³»ç»Ÿçš„è¿›é˜¶çŸ¥è¯† <a class="header-anchor" href="#å®æˆ˜-rag-ç³»ç»Ÿçš„è¿›é˜¶çŸ¥è¯†" aria-label="Permalink to &quot;å®æˆ˜ RAG ç³»ç»Ÿçš„è¿›é˜¶çŸ¥è¯†&quot;">â€‹</a></h2><h3 id="æ–‡æœ¬åˆ†å‰²çš„ç²’åº¦" tabindex="-1">æ–‡æœ¬åˆ†å‰²çš„ç²’åº¦ <a class="header-anchor" href="#æ–‡æœ¬åˆ†å‰²çš„ç²’åº¦" aria-label="Permalink to &quot;æ–‡æœ¬åˆ†å‰²çš„ç²’åº¦&quot;">â€‹</a></h3><p><strong>ç¼ºé™·</strong></p><ol><li>ç²’åº¦å¤ªå¤§å¯èƒ½å¯¼è‡´æ£€ç´¢ä¸ç²¾å‡†ï¼Œç²’åº¦å¤ªå°å¯èƒ½å¯¼è‡´ä¿¡æ¯ä¸å…¨é¢</li><li>é—®é¢˜çš„ç­”æ¡ˆå¯èƒ½è·¨è¶Šä¸¤ä¸ªç‰‡æ®µ</li></ol><p><strong>è§£å†³</strong></p><p>é‡å åˆ‡å‰²ï¼Œæ¯ä¸€æ®µåˆ‡å‰²çš„ç‰‡æ®µï¼Œå‘å‰å‘åä¼¸å±•ä¸€å®šé•¿åº¦ã€‚</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> nltk</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tokenize </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> sent_tokenize </span><span style="color:#676E95;font-style:italic;"># è‹±æ–‡åˆ†å¥ ï¼Œä¸­æ–‡ç”¨å‰é¢è‡ªå·±å†™çš„æ–¹æ³•</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> json</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">split_text</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">paragraphs</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">chunk_size</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">300</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">overlap_size</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span><span style="color:#676E95;font-style:italic;">æŒ‰æŒ‡å®š chunk_size å’Œ overlap_size äº¤å å‰²æ–‡æœ¬</span><span style="color:#89DDFF;font-style:italic;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    sentences </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">strip</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> p </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> paragraphs </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> s </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sent_tokenize</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">p</span><span style="color:#89DDFF;">)]</span></span>
<span class="line"><span style="color:#A6ACCD;">    chunks </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span></span>
<span class="line"><span style="color:#A6ACCD;">    i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">sentences</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        chunk </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> sentences</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">        overlap </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">        prev_len </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">        prev </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># å‘å‰è®¡ç®—é‡å éƒ¨åˆ†</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#A6ACCD;"> prev </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">sentences</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">prev</span><span style="color:#89DDFF;">])+</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">overlap</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> overlap_size</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            overlap </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> sentences</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">prev</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> overlap</span></span>
<span class="line"><span style="color:#A6ACCD;">            prev </span><span style="color:#89DDFF;">-=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">        chunk </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> overlap</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">chunk</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">next</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># å‘åè®¡ç®—å½“å‰chunk</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">next</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">sentences</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">sentences</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">next</span><span style="color:#89DDFF;">])+</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">chunk</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> chunk_size</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            chunk </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> chunk </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> sentences</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">next</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#82AAFF;">next</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">        chunks</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">chunk</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">next</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> chunks</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">chunks </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">split_text</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">paragraphs</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">300</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">vector_db </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MyVectorDBConnector</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demo_text_split</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> get_embeddings</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å‘å‘é‡æ•°æ®åº“ä¸­æ·»åŠ æ–‡æ¡£</span></span>
<span class="line"><span style="color:#A6ACCD;">vector_db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_documents</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">chunks</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>è¿”å›ç»“æœï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">===Prompt===</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">ä½ æ˜¯ä¸€ä¸ªé—®ç­”æœºå™¨äººã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;">ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ä¸‹è¿°ç»™å®šçš„å·²çŸ¥ä¿¡æ¯å›ç­”ç”¨æˆ·é—®é¢˜ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;">ç¡®ä¿ä½ çš„å›å¤å®Œå…¨ä¾æ®ä¸‹è¿°å·²çŸ¥ä¿¡æ¯ã€‚ä¸è¦ç¼–é€ ç­”æ¡ˆã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;">å¦‚æœä¸‹è¿°å·²çŸ¥ä¿¡æ¯ä¸è¶³ä»¥å›ç­”ç”¨æˆ·çš„é—®é¢˜ï¼Œè¯·ç›´æ¥å›å¤&quot;æˆ‘æ— æ³•å›ç­”æ‚¨çš„é—®é¢˜&quot;ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">å·²çŸ¥ä¿¡æ¯:</span></span>
<span class="line"><span style="color:#A6ACCD;">3ã€è¿‘æœŸå…¬å¸åœ¨ç ”å›½å®¶ I.I ç±»æ–°è¯ç¥ç€å…«æ°¢æ°¨å–å•¶ç‰‡é¡¹ç›®å¼•èµ·å¸‚åœºå¹¿æ³›å…³æ³¨ï¼Œ å…¬å¸æé†’å¹¿å¤§æŠ•èµ„è€…æ³¨æ„äºŒçº§å¸‚åœºç‚’ä½œé£é™©ã€‚ 4ã€ã€Šä¸­å›½è¯åˆ¸æŠ¥ã€‹ã€ã€Šè¯åˆ¸æ—¶æŠ¥ã€‹ã€ã€Šä¸Šæµ·è¯åˆ¸æŠ¥ã€‹å’Œå·¨æ½®èµ„è®¯ç½‘ä¸ºå…¬å¸é€‰å®šçš„</span></span>
<span class="line"><span style="color:#A6ACCD;">ä¿¡æ¯æŠ«éœ²åª’ä½“ï¼Œå…¬å¸æ‰€æœ‰ä¿¡æ¯å‡ä»¥åœ¨ä¸Šè¿°æŒ‡å®šåª’ä½“åˆŠç™»çš„ä¿¡æ¯ä¸ºå‡†ï¼Œè¯·å¹¿å¤§æŠ•èµ„ è€…ç†æ€§æŠ•èµ„ï¼Œæ³¨æ„é£é™©ã€‚ é€šåŒ–é‡‘é©¬è¯ä¸šé›†å›¢è‚¡ä»½æœ‰é™å…¬å¸è‘£äº‹ä¼š 2023 å¹´ 9 æœˆ 14 æ—¥</span></span>
<span class="line"><span style="color:#A6ACCD;">é™…æ§åˆ¶äººã€è‘£äº‹ä¼šã€ç®¡ç†å±‚è¿›è¡Œæ ¸å®ï¼Œç°å¯¹æœ‰å…³æ ¸å®æƒ…å†µè¯´æ˜å¦‚ä¸‹ï¼š 1ã€å…¬å¸å‰æœŸæŠ«éœ²çš„ä¿¡æ¯æœªå‘ç°éœ€è¦æ›´æ­£ã€è¡¥å……ä¹‹å¤„ã€‚ 2ã€å…¬å¸æœªå‘ç°è¿‘æœŸå…¬å…±ä¼ åª’æŠ¥é“å¯èƒ½æˆ–å·²ç»å¯¹å…¬å¸è‚¡ç¥¨äº¤æ˜“ä»·æ ¼äº§ç”Ÿè¾ƒå¤§ å½±å“çš„æœªå…¬å¼€é‡å¤§ä¿¡æ¯ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;">å–å•¶ç‰‡ III æœŸä¸´åºŠè¯•éªŒç›²æ€æ•°æ®å®¡æ ¸çš„å…¬å‘Šã€‹ï¼Œé›†å›¢å…¬å¸åŠå…¨èµ„å­å…¬å¸é•¿æ˜¥åæ´‹ é«˜ç§‘æŠ€æœ‰é™å…¬å¸è‡ªä¸»ç ”å‘ã€å…·æœ‰ç‹¬å®¶ä¸“åˆ©çš„ç¥ç€å…«æ°¢æ°¨å–å•¶ç‰‡é¡¹ç›®äº 2023 å¹´ 8</span></span>
<span class="line"><span style="color:#A6ACCD;">å…¬å¸ å‰æœŸæŠ«éœ²çš„ä¿¡æ¯ä¸å­˜åœ¨éœ€è¦æ›´æ­£ã€è¡¥å……ä¹‹å¤„ã€‚ 1ã€ç»è‡ªæŸ¥ï¼Œå…¬å¸ä¸å­˜åœ¨è¿åä¿¡æ¯å…¬å¹³æŠ«éœ²çš„æƒ…å½¢ã€‚ 2ã€æ–°è¯ç ”å‘å°¤å…¶æ˜¯å›½å®¶ I.I ç±»æ–°è¯çš„ç ”å‘å—åˆ°æŠ€æœ¯ã€å®¡æ‰¹ã€æ”¿ç­–ç­‰å¤šæ–¹é¢</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">ç”¨æˆ·é—®ï¼š</span></span>
<span class="line"><span style="color:#A6ACCD;">æ–‡ç« å‘å¸ƒä¸»ä½“æ˜¯ä»€ä¹ˆå…¬å¸ï¼Ÿ</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">è¯·ç”¨ä¸­æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">===å›å¤===</span></span>
<span class="line"><span style="color:#A6ACCD;">æ–‡ç« å‘å¸ƒä¸»ä½“æ˜¯é€šåŒ–é‡‘é©¬è¯ä¸šé›†å›¢è‚¡ä»½æœ‰é™å…¬å¸ã€‚</span></span></code></pre></div><p>æ•ˆæœç¡®å®è¦æ¯”ä¹‹å‰çš„å¥½ï¼Œä¹‹å‰è¿”å›ä¸äº†æ–‡ç« å‘å¸ƒä¸»ä½“</p><h3 id="æ£€ç´¢åæ’åº" tabindex="-1">æ£€ç´¢åæ’åº <a class="header-anchor" href="#æ£€ç´¢åæ’åº" aria-label="Permalink to &quot;æ£€ç´¢åæ’åº&quot;">â€‹</a></h3><p><strong>é—®é¢˜</strong>:</p><p>æœ‰æ—¶ï¼Œæœ€åˆé€‚çš„ç­”æ¡ˆä¸ä¸€å®šæ’åœ¨æ£€ç´¢çš„æœ€å‰é¢</p><p><strong>æ–¹æ¡ˆ</strong>:</p><ol><li>æ£€ç´¢æ—¶è¿‡æ‹›å›ä¸€éƒ¨åˆ†æ–‡æœ¬</li><li>é€šè¿‡ä¸€ä¸ªæ’åºæ¨¡å‹å¯¹ query å’Œ document é‡æ–°æ‰“åˆ†æ’åº</li></ol><img src="/MyBlog/images/ai/sbert-rerank.png" width="700px"><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">pip install sentence_transformers</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sentence_transformers </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> CrossEncoder</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">model </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CrossEncoder</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cross-encoder/ms-marco-MiniLM-L-6-v2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">max_length</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">512</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">user_query </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">how safe is llama 2</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">scores </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> model</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">predict</span><span style="color:#89DDFF;">([(</span><span style="color:#82AAFF;">user_query</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> doc</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">                       </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#82AAFF;"> doc </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#82AAFF;"> search_results</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">documents</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]])</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æŒ‰å¾—åˆ†æ’åº</span></span>
<span class="line"><span style="color:#A6ACCD;">sorted_list </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sorted</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    zip</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">scores</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> search_results</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">documents</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">key</span><span style="color:#89DDFF;">=</span><span style="color:#C792EA;">lambda</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> x</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">reverse</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> score</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> doc </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> sorted_list</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">score</span><span style="color:#F78C6C;">}</span><span style="color:#A6ACCD;">\t</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">doc</span><span style="color:#F78C6C;">}</span><span style="color:#A6ACCD;">\n</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>è¿™ä¸ªç”¨äºç¼©å‡å¬å›æ¡æ•°ï¼Œæ¯”è¾ƒæœ‰ç”¨ã€‚</p><h3 id="æ··åˆæ£€ç´¢-hybrid-search" tabindex="-1">æ··åˆæ£€ç´¢ï¼ˆHybrid Searchï¼‰ <a class="header-anchor" href="#æ··åˆæ£€ç´¢-hybrid-search" aria-label="Permalink to &quot;æ··åˆæ£€ç´¢ï¼ˆHybrid Searchï¼‰&quot;">â€‹</a></h3><p>åœ¨<strong>å®é™…ç”Ÿäº§</strong>ä¸­ï¼Œä¼ ç»Ÿçš„å…³é”®å­—æ£€ç´¢ï¼ˆç¨€ç–è¡¨ç¤ºï¼‰ä¸å‘é‡æ£€ç´¢ï¼ˆç¨ å¯†è¡¨ç¤ºï¼‰å„æœ‰ä¼˜åŠ£ã€‚</p><p>ä¸¾ä¸ªå…·ä½“ä¾‹å­ï¼Œæ¯”å¦‚æ–‡æ¡£ä¸­åŒ…å«å¾ˆé•¿çš„ä¸“æœ‰åè¯ï¼Œå…³é”®å­—æ£€ç´¢å¾€å¾€æ›´ç²¾å‡†è€Œå‘é‡æ£€ç´¢å®¹æ˜“å¼•å…¥æ¦‚å¿µæ··æ·†ã€‚</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">query </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">éå°ç»†èƒè‚ºç™Œçš„æ‚£è€…</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">documents </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ææŸæ‚£æœ‰è‚ºç™Œï¼Œç™Œç»†èƒå·²è½¬ç§»</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">åˆ˜æŸè‚ºç™ŒIæœŸ</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">å¼ æŸç»è¯Šæ–­ä¸ºéå°ç»†èƒè‚ºç™ŒIIIæœŸ</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">å°ç»†èƒè‚ºç™Œæ˜¯è‚ºç™Œçš„ä¸€ç§</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">query_vec </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_embeddings</span><span style="color:#89DDFF;">([</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">])[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">doc_vecs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_embeddings</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">documents</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cosine distance:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> vec </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> doc_vecs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">cos_sim</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">query_vec</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> vec</span><span style="color:#89DDFF;">))</span></span></code></pre></div><p>è¿”å›ç»“æœ</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Cosine distance:</span></span>
<span class="line"><span style="color:#A6ACCD;">0.9106675359933479</span></span>
<span class="line"><span style="color:#A6ACCD;">0.8895478505819983</span></span>
<span class="line"><span style="color:#A6ACCD;">0.9039165614288258</span></span>
<span class="line"><span style="color:#A6ACCD;">0.9131441645902685</span></span></code></pre></div><p>æ ¹æ®è¿”å›ç»“æœæ˜¯æœ€åä¸€ä¸ªæœ€è´´è¿‘æœç´¢ç»“æœï¼Œä½†å®é™…ä¸Šç›¸å·®äº†å¾ˆè¿œâ€¦â€¦</p><p>æ‰€ä»¥ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ç»“åˆä¸åŒçš„æ£€ç´¢ç®—æ³•ï¼Œæ¥è¾¾åˆ°æ¯”å•ä¸€æ£€ç´¢ç®—æ³•æ›´ä¼˜çš„æ•ˆæœã€‚è¿™å°±æ˜¯<strong>æ··åˆæ£€ç´¢</strong>ã€‚</p><p>æ··åˆæ£€ç´¢çš„æ ¸å¿ƒæ˜¯ï¼Œç»¼åˆæ–‡æ¡£ $d$ åœ¨ä¸åŒæ£€ç´¢ç®—æ³•ä¸‹çš„æ’åºåæ¬¡ï¼ˆrankï¼‰ï¼Œä¸ºå…¶ç”Ÿæˆæœ€ç»ˆæ’åºã€‚</p><p>ä¸€ä¸ªæœ€å¸¸ç”¨çš„ç®—æ³•å« <strong>Reciprocal Rank Fusionï¼ˆRRFï¼‰</strong></p><img src="/MyBlog/images/ai/RRF.png" width="700px"><p>å…¶ä¸­ A è¡¨ç¤ºæ‰€æœ‰ä½¿ç”¨çš„æ£€ç´¢ç®—æ³•çš„é›†åˆï¼Œrank_a(d) è¡¨ç¤ºä½¿ç”¨ç®—æ³• a æ£€ç´¢æ—¶ï¼Œæ–‡æ¡£ d çš„æ’åºï¼Œk æ˜¯ä¸ªå¸¸æ•°ã€‚</p><p>ç®€ç­”æ¥è¯´å°±æ˜¯ï¼Œç”¨ä¸€ä¸ªå¸¸æ•°åŠ ä¸Šä¸€ç§ç®—æ³•çš„æ’åï¼Œå–å€’æ•°ï¼Œç„¶åå„ç§ç®—æ³•çš„å¾—åˆ†å–å’Œã€‚è‡ªç„¶æ’åè¶Šé å‰ï¼Œå¾—åˆ†è¶Šé«˜ã€‚</p><p>å¾ˆå¤šå‘é‡æ•°æ®åº“éƒ½æ”¯æŒæ··åˆæ£€ç´¢ï¼Œæ¯”å¦‚ <a href="https://weaviate.io/blog/hybrid-search-explained" target="_blank" rel="noreferrer">Weaviate</a>ã€<a href="https://www.pinecone.io/learn/hybrid-search-intro/" target="_blank" rel="noreferrer">Pinecone</a> ç­‰ã€‚ä¹Ÿå¯ä»¥æ ¹æ®ä¸Šè¿°åŸç†è‡ªå·±å®ç°ã€‚</p><h3 id="rag-fusion" tabindex="-1">RAG-Fusion <a class="header-anchor" href="#rag-fusion" aria-label="Permalink to &quot;RAG-Fusion&quot;">â€‹</a></h3><p>RAG-Fusion å°±æ˜¯åˆ©ç”¨äº† RRF çš„åŸç†æ¥æå‡æ£€ç´¢çš„å‡†ç¡®æ€§ã€‚</p><img src="/MyBlog/images/ai/rag-fusion.jpeg" width="700px"><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼Œç”¨æˆ·ç»™å‡ºä¸€ä¸ª queryï¼Œç„¶åå‘é‡åŒ–ï¼Œé€šè¿‡æ¨¡å‹æŠŠè¿™ä¸ªqueryè½¬æ¢æˆå¤šä¸ªæ„æ€ç›¸åŒçš„queryï¼Œç„¶åç”¨ RRF è¿›è¡Œèåˆï¼Œå¾—å‡ºæœ€åçš„ç»“æœã€‚</p><p>åŸå§‹é¡¹ç›®ï¼ˆä¸€æ®µéå¸¸ç®€çŸ­çš„æ¼”ç¤ºä»£ç ï¼‰ï¼š<a href="https://github.com/Raudaschl/rag-fusion" target="_blank" rel="noreferrer">https://github.com/Raudaschl/rag-fusion</a></p><h2 id="å‘é‡æ¨¡å‹çš„æœ¬åœ°éƒ¨ç½²" tabindex="-1">å‘é‡æ¨¡å‹çš„æœ¬åœ°éƒ¨ç½² <a class="header-anchor" href="#å‘é‡æ¨¡å‹çš„æœ¬åœ°éƒ¨ç½²" aria-label="Permalink to &quot;å‘é‡æ¨¡å‹çš„æœ¬åœ°éƒ¨ç½²&quot;">â€‹</a></h2><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sentence_transformers </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> SentenceTransformer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#model_name = &#39;BAAI/bge-large-zh-v1.5&#39; #ä¸­æ–‡</span></span>
<span class="line"><span style="color:#A6ACCD;">model_name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">moka-ai/m3e-base</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#ä¸­è‹±åŒè¯­ï¼Œä½†æ•ˆæœä¸€èˆ¬</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">model </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SentenceTransformer</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">model_name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#query = &quot;å›½é™…äº‰ç«¯&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">query </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">global conflicts</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">documents </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">è”åˆå›½å°±è‹ä¸¹è¾¾å°”å¯Œå°”åœ°åŒºå¤§è§„æ¨¡æš´åŠ›äº‹ä»¶å‘å‡ºè­¦å‘Š</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">åœŸè€³å…¶ã€èŠ¬å…°ã€ç‘å…¸ä¸åŒ—çº¦ä»£è¡¨å°†ç»§ç»­å°±ç‘å…¸â€œå…¥çº¦â€é—®é¢˜è¿›è¡Œè°ˆåˆ¤</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">æ—¥æœ¬å²é˜œå¸‚é™†ä¸Šè‡ªå«é˜Ÿå°„å‡»åœºå†…å‘ç”Ÿæªå‡»äº‹ä»¶ 3äººå—ä¼¤</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">å›½å®¶æ¸¸æ³³ä¸­å¿ƒï¼ˆæ°´ç«‹æ–¹ï¼‰ï¼šæ¢å¤æ¸¸æ³³ã€å¬‰æ°´ä¹å›­ç­‰æ°´ä¸Šé¡¹ç›®è¿è¥</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">æˆ‘å›½é¦–æ¬¡åœ¨ç©ºé—´ç«™å¼€å±•èˆ±å¤–è¾å°„ç”Ÿç‰©å­¦æš´éœ²å®éªŒ</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">query_vec </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> model</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encode</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">doc_vecs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    model</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encode</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">doc</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> doc </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> documents</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cosine distance:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># è¶Šå¤§è¶Šç›¸ä¼¼</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#print(cos_sim(query_vec, query_vec))</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> vec </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> doc_vecs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">cos_sim</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">query_vec</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> vec</span><span style="color:#89DDFF;">))</span></span></code></pre></div><p>è¿”å›ç»“æœ</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Cosine distance:</span></span>
<span class="line"><span style="color:#A6ACCD;">0.6958812</span></span>
<span class="line"><span style="color:#A6ACCD;">0.65735227</span></span>
<span class="line"><span style="color:#A6ACCD;">0.6653426</span></span>
<span class="line"><span style="color:#A6ACCD;">0.6371888</span></span>
<span class="line"><span style="color:#A6ACCD;">0.6942898</span></span></code></pre></div><p>æ‰©å±•é˜…è¯»ï¼š<a href="https://github.com/FlagOpen/FlagEmbedding" target="_blank" rel="noreferrer">https://github.com/FlagOpen/FlagEmbedding</a></p><ul><li>ä¸æ˜¯æ¯ä¸ª Embedding æ¨¡å‹éƒ½å¯¹ä½™å¼¦è·ç¦»å’Œæ¬§æ°è·ç¦»åŒæ—¶æœ‰æ•ˆ</li><li>å“ªç§ç›¸ä¼¼åº¦è®¡ç®—æœ‰æ•ˆè¦é˜…è¯»æ¨¡å‹çš„è¯´æ˜ï¼ˆé€šå¸¸éƒ½æ”¯æŒä½™å¼¦è·ç¦»è®¡ç®—ï¼‰</li></ul><h2 id="æ€»ç»“" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“" aria-label="Permalink to &quot;æ€»ç»“&quot;">â€‹</a></h2><ul><li><p>ç¦»çº¿æ­¥éª¤ï¼š</p><ol><li>æ–‡æ¡£åŠ è½½</li><li>æ–‡æ¡£åˆ‡åˆ†</li><li>å‘é‡åŒ–</li><li>çŒå…¥å‘é‡æ•°æ®åº“</li></ol></li><li><p>åœ¨çº¿æ­¥éª¤ï¼š</p><ol><li>è·å¾—ç”¨æˆ·é—®é¢˜</li><li>ç”¨æˆ·é—®é¢˜å‘é‡åŒ–</li><li>æ£€ç´¢å‘é‡æ•°æ®åº“</li><li>å°†æ£€ç´¢ç»“æœå’Œç”¨æˆ·é—®é¢˜å¡«å…¥ Prompt æ¨¡ç‰ˆ</li><li>ç”¨æœ€ç»ˆè·å¾—çš„ Prompt è°ƒç”¨ LLM</li><li>ç”± LLM ç”Ÿæˆå›å¤</li></ol></li></ul></div></div></main><footer class="VPDocFooter" data-v-746cb8a2 data-v-b5dc3141><!--[--><!--]--><div class="edit-info" data-v-b5dc3141><div class="edit-link" data-v-b5dc3141><a class="VPLink link edit-link-button" href="https://github.com/fzdwx/vitepress-blog-theme/blob/main/content/docs/AI/RAGembeddings.md" target="_blank" rel="noreferrer" data-v-b5dc3141 data-v-151d3d72><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-b5dc3141><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> âœ<!--]--><!----></a></div><!----></div><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div></div><div class="my-[100px]"></div><!----></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"readme.md\":\"876d9de9\",\"content_docs_math_cartesiancoordinatesystem.md\":\"faca925f\",\"content_docs_javascript_functionalprogramming.md\":\"1fedabb1\",\"links.md\":\"8dce4be4\",\"content_docs_javascript_jsmemory.md\":\"f6da417d\",\"content_docs_javascript_v8enginrabish.md\":\"44932ff2\",\"content_docs_javascript_debounce_throttle.md\":\"4c0ebdb6\",\"content_docs_typescript_generic.md\":\"cdde2351\",\"tags.md\":\"dd9ab385\",\"content_docs_typescript_declare.md\":\"64c6ecf5\",\"content_docs_python_datatypeandvars.md\":\"48976dce\",\"content_docs_typescript_annotation.md\":\"aedb5c7c\",\"content_docs_webpack_bundlespeedup.md\":\"49db8728\",\"content_docs_typescript_commandlinecomplier.md\":\"60c67238\",\"content_docs_typescript_namespace.md\":\"b1c45ea1\",\"content_issues_1.md\":\"721ccd56\",\"content_docs_git_gitsubmodule.md\":\"8da8a861\",\"content_issues_3.md\":\"475d7b66\",\"content_docs_javascript_eventflow_evevtproxy.md\":\"2e4f1b10\",\"qa.md\":\"ac29c397\",\"index.md\":\"1fda215c\",\"content_docs_python_listandtuple.md\":\"6281ad43\",\"content_docs_webpack_loader-jscomplie.md\":\"d7ed7c33\",\"content_docs_typescript_object.md\":\"93e65ea6\",\"content_docs_typescript_typemapping.md\":\"31f28395\",\"content_docs_typescript_typeoperatorl.md\":\"73217247\",\"content_docs_typescript_interface.md\":\"cc8c4068\",\"content_docs_typescript_module.md\":\"6840d596\",\"content_docs_webpack_devserver.md\":\"cc351fb4\",\"content_docs_typescript_d.ts.md\":\"bfdeb525\",\"content_docs_vue_defineproperty_proxy.md\":\"04e08256\",\"content_docs_webpack_optimization.md\":\"d7b0dfd3\",\"content_docs_javascript_commonlyusedfunctions.md\":\"3f486c1c\",\"content_docs_typescript_tsconfig.md\":\"90543025\",\"content_docs_webpack_imgloader.md\":\"dc07885e\",\"content_docs_webpack_htmlcomplie.md\":\"c735f791\",\"content_docs_typescript_enum.md\":\"4f43b514\",\"content_docs_typescript_decorator.md\":\"5388c6db\",\"content_docs_typescript_typeassertion.md\":\"98c63632\",\"content_docs_typescript_typetools.md\":\"599e2d2d\",\"content_docs_typescript_function.md\":\"1dc57146\",\"content_docs_typescript_class.md\":\"7b09e725\",\"content_docs_ai_promptengineering.md\":\"3a9a001e\",\"content_docs_vue_vuelifecycle_principle.md\":\"07eb1d1d\",\"content_docs_typescript_decoratorold.md\":\"af1be93b\",\"content_docs_ai_ragembeddings.md\":\"d4ed9e1b\",\"content_docs_ai_functioncalling.md\":\"0687668b\",\"content_docs_ai_assistantsapi.md\":\"bc330201\"}")
function deserializeFunctions(value) {
  if (Array.isArray(value)) {
    return value.map(deserializeFunctions);
  } else if (typeof value === "object" && value !== null) {
    return Object.keys(value).reduce((acc, key) => {
      acc[key] = deserializeFunctions(value[key]);
      return acc;
    }, {});
  } else if (typeof value === "string" && value.startsWith("_vp-fn_")) {
    return new Function(`return ${value.slice(7)}`)();
  } else {
    return value;
  }
}
__VP_SITE_DATA__ = deserializeFunctions(JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Ethan\",\"description\":\"Ethan's Note.\",\"base\":\"/MyBlog/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"sortBy\":\"date\",\"icon\":\"https://raw.githubusercontent.com/fzdwx/blog-history/main/static/images/party_parrot.gif\",\"dateFormat\":\"YYYY-MM-DD HH:mm:ss\",\"editLink\":{\"text\":\"âœ\",\"pattern\":\"_vp-fn_({ relativePath }) => {\\n        return `https://github.com/fzdwx/vitepress-blog-theme/blob/main/${relativePath}`;\\n      }\"},\"issues\":{\"showComment\":true},\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Notes\",\"link\":\"/tags?layout=issue\"},{\"text\":\"Docs\",\"link\":\"/tags?layout=doc\"},{\"text\":\"Tags\",\"link\":\"/tags?layout=post\",\"activeMatch\":\"\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/fzdwx/vitepress-blog-theme\"}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}"))</script>
    
  </body>
</html>